# üöÄ Quick Fix Guide - Login Not Working on Render

## Problem
Your HR application is deployed on Render but login doesn't work when you enter credentials.

## Root Causes
1. **Missing `/api` in frontend environment variable**
2. **CORS configuration issues**
3. **Environment variables not properly set**
4. **MongoDB connection issues**

## ‚úÖ Solution - Follow These Steps

### Step 1: Fix Frontend Environment Variable (CRITICAL)

1. Go to **Render Dashboard** ‚Üí Your **Frontend Service**
2. Click **Environment** tab
3. Find `VITE_API_URL` variable
4. **Make sure it ends with `/api`**:
   ```
   VITE_API_URL=https://hr-management-backend.onrender.com/api
   ```
   ‚ö†Ô∏è **NOT**: `https://hr-management-backend.onrender.com` (missing /api)
5. Click **Save Changes**
6. Frontend will automatically redeploy (wait 2-3 minutes)

### Step 2: Fix Backend CORS Configuration

1. Go to **Render Dashboard** ‚Üí Your **Backend Service**
2. Click **Environment** tab
3. Verify `FRONTEND_URL` matches your actual frontend URL:
   ```
   FRONTEND_URL=https://hr-management-frontend.onrender.com
   ```
   (Replace with your actual frontend URL - no trailing slash)
4. Click **Save Changes**
5. Backend will automatically redeploy (wait 2-3 minutes)

### Step 3: Verify MongoDB Access

1. Go to **MongoDB Atlas** (https://cloud.mongodb.com)
2. Click **Network Access** (left sidebar)
3. Make sure you have: `0.0.0.0/0` (Allow from anywhere)
4. If not, click **Add IP Address** ‚Üí **Allow Access from Anywhere** ‚Üí **Confirm**

### Step 4: Verify Backend is Running

1. Open this URL in your browser:
   ```
   https://YOUR-BACKEND-URL.onrender.com/api/health
   ```
2. You should see:
   ```json
   {"status":"ok","message":"HR Management API is running"}
   ```
3. If you see an error, check backend logs in Render dashboard

### Step 5: Test Login

1. Open your frontend URL
2. Try logging in with:
   - **Email**: `admin@company.com`
   - **Password**: `password`

3. If it still doesn't work, open browser console (F12) and check for errors

## üîç Diagnostic Tools

### Option 1: Use Test Connection Page

1. Open `test-connection.html` in your browser (from this repo)
2. Enter your backend URL
3. Click "Test Connection"
4. Try test login
5. Check results for specific errors

### Option 2: Check Browser Console

1. Open your deployed frontend
2. Press **F12** to open Developer Tools
3. Go to **Console** tab
4. Try to login
5. Look for error messages

**Common Errors:**

| Error | Solution |
|-------|----------|
| `Failed to fetch` | Backend is down or URL is wrong |
| `CORS policy` | FRONTEND_URL in backend doesn't match |
| `401 Unauthorized` | Wrong credentials or no users in database |
| `Network Error` | VITE_API_URL is wrong or missing `/api` |

### Option 3: Check Backend Logs

1. Go to Render Dashboard ‚Üí Backend Service
2. Click **Logs** tab
3. Look for errors when you try to login

## üéØ Expected Configuration

After fixes, your environment variables should be:

### Frontend Environment Variables
```
VITE_API_URL=https://hr-management-backend.onrender.com/api
```

### Backend Environment Variables
```
NODE_ENV=production
PORT=5000
FRONTEND_URL=https://hr-management-frontend.onrender.com
MONGODB_URI=mongodb+srv://hr_admin:hrpassword123@cluster0.w5ypk0z.mongodb.net/hr-management?retryWrites=true&w=majority&appName=Cluster0
JWT_SECRET=<auto-generated-by-render>
JWT_EXPIRE=30d
MFA_ISSUER=HR Management System
```

## üîê Default Login Credentials

| Role | Email | Password |
|------|-------|----------|
| Admin | admin@company.com | password |
| HR Manager | hr@company.com | password |
| Employee | n@gmail.com | password |

## ‚ö° Quick Checklist

Before testing, verify:

- [ ] `VITE_API_URL` ends with `/api`
- [ ] `FRONTEND_URL` matches your actual frontend URL
- [ ] Backend health check works
- [ ] MongoDB Atlas allows `0.0.0.0/0`
- [ ] Both services show "Live" status in Render
- [ ] No errors in backend logs
- [ ] Browser console shows no CORS errors

## üÜò Still Not Working?

### If you see "Invalid email or password":

The database might not have users. Run seed script:

1. Go to Backend Service in Render
2. Click **Shell** tab
3. Run:
   ```bash
   node utils/seed.js
   ```

### If you see CORS errors:

1. Double-check `FRONTEND_URL` in backend exactly matches your frontend URL
2. Make sure there's no trailing slash
3. Redeploy backend after changes

### If backend health check fails:

1. Check backend logs for errors
2. Verify all environment variables are set
3. Check if MongoDB connection is working

## üìö Additional Resources

- **Full Deployment Guide**: See `RENDER_DEPLOYMENT_STEPS.md`
- **Troubleshooting**: See `RENDER_LOGIN_FIX.md`
- **API Documentation**: See `docs/API_REFERENCE.md`

## üí° Pro Tips

1. **Free Tier Sleep**: Render free tier services sleep after 15 minutes of inactivity. First request may take 30-60 seconds to wake up.

2. **Clear Cache**: After making changes, clear your browser cache (Ctrl+Shift+Delete) or use incognito mode.

3. **Check Both Services**: Make sure both frontend AND backend services are "Live" in Render dashboard.

4. **Environment Variables**: Any change to environment variables triggers automatic redeployment.

---

**Need Help?** Check the browser console (F12) and backend logs for specific error messages.
